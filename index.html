<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Workout Rest Timer</title>
<link rel="icon" href="resttimer-roundcap-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
<link rel="icon" href="resttimer-roundcap-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
<style>
  /* Global CSS Variables for Theming */
  :root{
    --bg: #0f1419;
    --card: #141a21;
    --text: #eaf0f6;
    --muted:#9fb0c1;
    --ring:#2e7cf7;
    --ring-15:#ff8a22;
    --accent:#2e7cf7;
    --accent-press:#1f66d6;
    --btn:#1a2230;
    --btn-text:#eaf0f6;
    --pill:#10161d;
    --pill-border:#243040;
    --shadow: 0 4px 12px rgba(0,0,0,.15), 0 1px 2px rgba(0,0,0,.1);
    --warn-fill: rgba(255,138,34,.15);
  }
  .light{
    --bg:#f6f8fb;
    --card:#ffffff;
    --text:#0b1722;
    --muted:#6b7c8d;
    --ring:#1f6eff;
    --ring-15:#ff7a1a;
    --accent:#1f6eff;
    --accent-press:#0d50cc;
    --btn:#eff2f6;
    --btn-text:#2d3a46;
    --pill:#eaf0f6;
    --pill-border:#d1dce6;
    --shadow: 0 4px 12px rgba(0,0,0,.1), 0 1px 2px rgba(0,0,0,.05);
    --warn-fill: rgba(255,122,26,.15);
  }
  .auto{
    color-scheme: dark light;
  }
  @media (prefers-color-scheme: light) {
    .auto{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0b1722;
      --muted:#6b7c8d;
      --ring:#1f6eff;
      --ring-15:#ff7a1a;
      --accent:#1f6eff;
      --accent-press:#0d50cc;
      --btn:#eff2f6;
      --btn-text:#2d3a46;
      --pill:#eaf0f6;
      --pill-border:#d1dce6;
      --shadow: 0 4px 12px rgba(0,0,0,.1), 0 1px 2px rgba(0,0,0,.05);
      --warn-fill: rgba(255,122,26,.15);
    }
  }

  /* General Styles */
  html{
    height: 100%;
    -webkit-tap-highlight-color: transparent;
  }
  body{
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    color: var(--text);
    background-color: var(--bg);
    /* Flexbox for a robust vertical layout */
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow: hidden; /* Prevents unwanted scrolling */
  }
  *{
    box-sizing: border-box;
    /* Use rounded corners for a modern look */
    border-radius: 0.75rem;
  }
  p, h1, h2, h3, h4, h5, h6, ul, ol{
    margin: 0;
  }

  /* Main Container Layout */
  .container{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    flex-grow: 1; /* Allows the main content to take up available space */
  }

  /* Header and Footer Layout */
  header, footer{
    width: 100%;
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 10;
  }
  header{
    margin-bottom: 2rem; /* Add spacing between header and main content */
    top: 0;
  }
  footer{
    margin-top: 2rem; /* Add spacing between footer and main content */
    bottom: 0;
  }
  .workout-info{
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    flex-grow: 1;
  }
  .workout-label{
    font-size: 1rem;
    color: var(--muted);
  }
  .workout-letter{
    font-size: 2rem;
    font-weight: 500;
  }

  /* Timer and Circle */
  .timer-circle-wrap{
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    width: 80vmin; /* Responsive sizing for the container */
    height: 80vmin;
    max-width: 400px;
    max-height: 400px;
    padding: 1rem;
  }
  .timer-svg{
    position: absolute;
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }
  .timer-ring-bg{
    stroke: var(--card);
    stroke-width: 10px;
    fill: transparent;
  }
  .timer-ring{
    stroke: var(--ring);
    stroke-width: 10px;
    fill: transparent;
    stroke-dasharray: 565.48px; /* Circumference of a 180px radius circle */
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 0.1s linear;
  }
  .timer-digits-wrap{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
  }
  .timer-digits{
    /* Use clamp() for responsive font size that doesn't get too large or small */
    font-size: clamp(2.5rem, 15vw, 15rem); 
    font-weight: 700;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    transition: all 0.2s ease-in-out;
  }
  .timer-digits.warning{
    color: var(--ring-15);
  }
  .status{
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--muted);
  }
  .warning-status{
    background-color: var(--warn-fill);
    color: var(--ring-15);
    padding: 0.25rem 0.75rem;
    border-radius: 0.5rem;
    font-weight: 500;
  }

  /* Control Buttons */
  .control-row{
    display: flex;
    gap: 1.5rem;
    margin: 1.5rem 0;
  }
  .control-btn, .mini-btn{
    cursor: pointer;
    font-size: 1.25rem;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    background-color: var(--btn);
    color: var(--btn-text);
    transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
  }
  .control-btn:active, .mini-btn:active{
    transform: scale(0.95);
  }
  .control-btn.accent{
    background-color: var(--accent);
    color: var(--text);
  }
  .control-btn.accent:active{
    background-color: var(--accent-press);
  }
  .mini-btn{
    padding: 0.5rem;
    font-size: 1.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 3rem;
    width: 3rem;
  }

  /* Log and Preset Modals */
  .modal{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.75);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-content{
    background-color: var(--card);
    padding: 2rem;
    max-width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    position: relative;
    border-radius: 1rem;
  }
  .close-btn{
    background: transparent;
    border: none;
    color: var(--text);
    font-size: 1.5rem;
    position: absolute;
    top: 1rem;
    right: 1rem;
    cursor: pointer;
  }
  .modal-title{
    text-align: center;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  .modal-log-item, .modal-list-item{
    padding: 0.75rem 1rem;
    background-color: var(--btn);
    border-radius: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-log-item span{
    font-size: 1rem;
  }
  .clear-log-btn{
    cursor: pointer;
    background-color: var(--btn);
    color: var(--btn-text);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
  }
  .preset-form{
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
  }
  .preset-form input{
    background-color: var(--btn);
    color: var(--btn-text);
    border: none;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
  }
  .preset-form input[type="number"]{
    width: 4rem;
  }
  .preset-form button{
    cursor: pointer;
    background-color: var(--accent);
    color: var(--text);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
  }
  .modal-list-item{
    background-color: var(--card);
    border: 1px solid var(--pill-border);
    justify-content: flex-start;
    gap: 1rem;
  }
  .modal-list-item button{
    background-color: var(--btn);
    color: var(--btn-text);
    border: none;
    font-size: 1rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    cursor: pointer;
  }
  .modal-list-item button.delete-btn{
    margin-left: auto;
    background-color: transparent;
    color: var(--muted);
  }
  .pill-container{
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-top: 1rem;
  }
  .pill{
    padding: 0.5rem 1rem;
    background-color: var(--pill);
    border: 1px solid var(--pill-border);
    cursor: pointer;
    border-radius: 2rem;
    font-size: 0.875rem;
  }
  .pill.active{
    background-color: var(--accent);
    color: var(--text);
    border-color: var(--accent);
  }

</style>
</head>
<body class="auto">

  <!-- Header Section -->
  <header>
    <button id="logBtn" class="control-btn mini-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M12 4v16"/><path d="M12 4H3"/><path d="M21 4H12"/><path d="M7 20v-4"/><path d="M17 4v2"/><path d="M17 10v4"/><path d="M7 8v8"/></svg>
    </button>
    <div class="workout-info">
      <p class="workout-label">Workout #</p>
      <h2 id="workoutLetter" class="workout-letter">A</h2>
    </div>
    <button id="presetsBtn" class="control-btn mini-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 12.5h-5M15 10v5"/><circle cx="12" cy="12" r="10"/><path d="M12 2v20"/></svg>
    </button>
  </header>

  <!-- Main Timer Content -->
  <main class="container">
    <div class="timer-circle-wrap">
      <svg id="timerSvg" class="timer-svg" viewBox="0 0 400 400">
        <circle class="timer-ring-bg" cx="200" cy="200" r="180"/>
        <circle id="timerRing" class="timer-ring" cx="200" cy="200" r="180"/>
      </svg>
      <div class="timer-digits-wrap">
        <h1 id="timerDigits" class="timer-digits">3:00</h1>
        <p id="timerStatus" class="status">Ready</p>
      </div>
    </div>
    <div class="pill-container" id="presetsPills"></div>
  </main>

  <!-- Footer Controls -->
  <footer>
    <button id="undoBtn" class="control-btn mini-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 7.5l5 5l-5 5"/><path d="M21.5 12h-14"/><path d="M21.5 12v5"/><path d="M21.5 12h-14"/></svg>
    </button>
    <button id="minusBtn" class="control-btn mini-btn">-</button>
    <button id="startBtn" class="control-btn accent">START</button>
    <button id="plusBtn" class="control-btn mini-btn">+</button>
    <button id="nextBtn" class="control-btn mini-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 7.5l-5 5l5 5"/><path d="M2.5 12h14"/><path d="M2.5 12v5"/><path d="M2.5 12h14"/></svg>
    </button>
  </footer>

  <!-- Modals -->
  <div id="logModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h3 class="modal-title">Workout Log</h3>
      <div id="logList"></div>
      <button id="clearLogBtn" class="clear-log-btn">Clear Log</button>
    </div>
  </div>

  <div id="presetsModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h3 class="modal-title">Presets</h3>
      <div id="presetList"></div>
      <form id="presetForm" class="preset-form">
        <input id="newMins" type="number" min="0" max="60" placeholder="min" value="0"/>
        <input id="newSecs" type="number" min="0" max="59" placeholder="sec" value="30"/>
        <input id="newSets" type="number" min="1" max="99" placeholder="sets" value="1"/>
        <button type="submit">Add</button>
      </form>
    </div>
  </div>

<script>
(function(){
  const store = {
    set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
    get: (key) => {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : null;
      } catch (e) {
        console.error("Error parsing JSON from localStorage", e);
        return null;
      }
    }
  };

  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  const timerDigits = $('#timerDigits');
  const timerRing = $('#timerRing');
  const timerStatus = $('#timerStatus');
  const presetsPills = $('#presetsPills');
  const workoutLetter = $('#workoutLetter');

  const startBtn = $('#startBtn');
  const nextBtn = $('#nextBtn');
  const undoBtn = $('#undoBtn');
  const minusBtn = $('#minusBtn');
  const plusBtn = $('#plusBtn');

  const logBtn = $('#logBtn');
  const presetsBtn = $('#presetsBtn');
  const logModal = $('#logModal');
  const presetsModal = $('#presetsModal');
  const logList = $('#logList');
  const presetList = $('#presetList');
  const clearLogBtn = $('#clearLogBtn');

  const state = {
    remaining: 0,
    interval: null,
    isPaused: true,
    initialDuration: 0,
    currentSet: 0,
    workoutLetterIndex: store.get('workoutLetterIndex') || 0,
    presets: store.get('presets') || [{ seconds: 30, sets: 1 }],
    log: store.get('log') || []
  };

  let presetIndex = store.get('presetIndex') || 0;
  if (!state.presets[presetIndex]) {
    presetIndex = 0;
    store.set('presetIndex', 0);
  }

  const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

  const minsSec = (ms) => {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  const formatTime = (ms) => {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  const savePresets = () => store.set('presets', state.presets);
  const saveLog = () => store.set('log', state.log);

  const resetTimer = () => {
    clearInterval(state.interval);
    state.isPaused = true;
    timerStatus.textContent = "Ready";
    startBtn.textContent = 'START';
    timerDigits.classList.remove('warning');
    timerRing.style.strokeDashoffset = 0;
    state.remaining = state.initialDuration;
    timerDigits.textContent = formatTime(state.remaining);
  };

  const updateTimer = () => {
    if (state.remaining <= 0) {
      completeSet();
      return;
    }
    state.remaining -= 100;
    timerDigits.textContent = formatTime(state.remaining);
    const dashOffset = (1 - state.remaining / state.initialDuration) * 565.48;
    timerRing.style.strokeDashoffset = dashOffset;
    
    // Warn when time is low
    if (state.remaining <= 15000 && !timerDigits.classList.contains('warning')) {
      timerDigits.classList.add('warning');
      timerStatus.textContent = "Almost there!";
    }
  };

  const completeSet = () => {
    resetTimer();
    state.currentSet++;
    const currentPreset = state.presets[presetIndex];
    if (state.currentSet >= currentPreset.sets) {
      state.currentSet = 0;
      logWorkout();
    }
    timerStatus.textContent = "Set completed. Ready for next set.";
  };

  const logWorkout = () => {
    const workout = {
      id: Date.now(),
      letter: alphabet[state.workoutLetterIndex % alphabet.length],
      preset: { ...state.presets[presetIndex] },
      timestamp: new Date().toISOString()
    };
    state.log.unshift(workout);
    saveLog();
    state.workoutLetterIndex++;
    store.set('workoutLetterIndex', state.workoutLetterIndex);
    renderLog();
    updateWorkoutLetter();
  };

  const updateWorkoutLetter = () => {
    workoutLetter.textContent = alphabet[state.workoutLetterIndex % alphabet.length];
  };

  const toggleStart = () => {
    if (state.isPaused) {
      startBtn.textContent = 'PAUSE';
      timerStatus.textContent = "Running";
      state.isPaused = false;
      state.interval = setInterval(updateTimer, 100);
    } else {
      startBtn.textContent = 'RESUME';
      timerStatus.textContent = "Paused";
      state.isPaused = true;
      clearInterval(state.interval);
    }
  };

  const next = () => {
    const currentPreset = state.presets[presetIndex];
    state.currentSet++;
    if (state.currentSet >= currentPreset.sets) {
      state.currentSet = 0;
      logWorkout();
      resetTimer();
    } else {
      resetTimer();
      toggleStart();
    }
  };

  const undo = () => {
    if (state.log.length > 0) {
      state.log.shift();
      saveLog();
      renderLog();
      state.workoutLetterIndex = Math.max(0, state.workoutLetterIndex - 1);
      store.set('workoutLetterIndex', state.workoutLetterIndex);
      updateWorkoutLetter();
    }
  };

  const nudger = (ms) => {
    state.remaining = Math.max(0, state.remaining + ms);
    timerDigits.textContent = formatTime(state.remaining);
    if (state.interval) updateTimer();
  };

  const renderLog = () => {
    logList.innerHTML = state.log.map(item => `
      <div class="modal-log-item">
        <span>Workout ${item.letter} - ${minsSec(item.preset.seconds)} ×${item.preset.sets}</span>
        <span>${new Date(item.timestamp).toLocaleString()}</span>
      </div>
    `).join('');
  };

  const renderPresets = () => {
    presetsPills.innerHTML = state.presets.map((p, i) => `
      <button class="pill ${i === presetIndex ? 'active' : ''}" data-index="${i}">
        ${minsSec(p.seconds)} ×${p.sets}
      </button>
    `).join('');
    
    // Add event listeners for new buttons
    $$('.pill').forEach(pill => {
      pill.addEventListener('click', (e) => {
        selectPreset(e.target.dataset.index);
      });
    });
  };

  const selectPreset = (index) => {
    presetIndex = parseInt(index, 10);
    store.set('presetIndex', presetIndex);
    state.currentSet = 0;
    const selectedPreset = state.presets[presetIndex];
    state.initialDuration = selectedPreset.seconds;
    state.remaining = selectedPreset.seconds;
    timerDigits.textContent = formatTime(state.initialDuration);
    resetTimer();
    renderPresets();
  };

  const openModal = (modal) => modal.style.display = 'flex';
  const closeModal = (modal) => modal.style.display = 'none';

  logBtn.addEventListener('click', () => {
    renderLog();
    openModal(logModal);
  });

  presetsBtn.addEventListener('click', () => {
    renderPresetsModal();
    openModal(presetsModal);
  });

  const renderPresetsModal = () => {
    presetList.innerHTML = state.presets.map((p,i) => `
      <div class="modal-list-item">
        <span>${minsSec(p.seconds)} ×${p.sets}</span>
        <button class="delete-btn" data-index="${i}">&times;</button>
      </div>
    `).join('');
    $$('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const index = e.target.dataset.index;
        state.presets.splice(index, 1);
        savePresets();
        renderPresets();
        renderPresetsModal();
        if (state.presets.length === 0) {
          state.presets.push({ seconds: 30, sets: 1 });
          savePresets();
          selectPreset(0);
        } else if (presetIndex >= state.presets.length) {
          selectPreset(state.presets.length - 1);
        } else {
          selectPreset(presetIndex);
        }
      });
    });
  };

  $('#presetForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const mins = parseInt($('#newMins').value, 10) || 0;
    const secs = parseInt($('#newSecs').value, 10) || 0;
    const sets = parseInt($('#newSets').value, 10) || 1;
    if ((mins * 60 + secs) > 0) {
      state.presets.push({ seconds: (mins * 60 + secs) * 1000, sets });
      savePresets();
      renderPresets();
      renderPresetsModal();
    }
  });

  // Universal close button for modals
  $$('.close-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      closeModal(e.target.closest('.modal'));
    });
  });

  startBtn.addEventListener('click', toggleStart);
  nextBtn.addEventListener('click', next);
  undoBtn.addEventListener('click', undo);
  minusBtn.addEventListener('click', () => nudger(-15000));
  plusBtn.addEventListener('click', () => nudger(15000));
  clearLogBtn.addEventListener('click', () => {
    store.set('log', []);
    renderLog();
    store.set('workoutLetterIndex', 0);
    state.workoutLetterIndex = 0;
    updateWorkoutLetter();
  });

  renderPresets();
  selectPreset(presetIndex);
  renderLog();
  updateWorkoutLetter();

  setInterval(() => {
    if (!isFinite(state.remaining)) resetTimer();
    if (!timerDigits.textContent || timerDigits.textContent.includes('NaN')) timerDigits.textContent = formatTime(state.remaining);
  }, 500);

})();
</script>
</body>
</html>
